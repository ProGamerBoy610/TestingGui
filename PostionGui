local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local lp = Players.LocalPlayer
local fakeDead = false
local humanoid
local animationStopped = false

-- ✅ Fake Death Function
local function fakeDeath()
    local char = lp.Character or lp.CharacterAdded:Wait()
    humanoid = char:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    fakeDead = true
    humanoid:ChangeState(Enum.HumanoidStateType.Physics)
    humanoid.PlatformStand = true

    for _, part in ipairs(char:GetDescendants()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            part.Anchored = false
            part.Velocity = Vector3.new(math.random(-5,5), 15, math.random(-5,5))
        end
    end

    print("[💀] Fake death activated.")
end

-- ✅ Recover Function
local function recover()
    if not humanoid then return end

    fakeDead = false
    animationStopped = false
    humanoid.PlatformStand = false
    humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)

    print("[✅] Recovered from fake death.")
end

-- ✅ Monitor for Real Death and Freeze
RunService.Heartbeat:Connect(function()
    local char = lp.Character
    if not char then return end
    humanoid = humanoid or char:FindFirstChildOfClass("Humanoid")

    if humanoid and humanoid.Health <= 0 then
        humanoid.PlatformStand = true
        humanoid.WalkSpeed = 0

        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.Anchored = true
                part.Velocity = Vector3.zero
            end
        end

        -- ❌ Stop animations once on death
        if not animationStopped then
            local animator = humanoid:FindFirstChildOfClass("Animator")
            if animator then
                for _, track in ipairs(animator:GetPlayingAnimationTracks()) do
                    track:Stop()
                end
                animationStopped = true
                print("[🛑] Stopped all animations on death.")
            end
        end
    end
end)

-- ✅ Detect Joystick Movement or Jump (but NOT camera)
RunService.RenderStepped:Connect(function()
    if not fakeDead or not humanoid then return end

    local moveVec = humanoid.MoveDirection
    if moveVec.Magnitude > 0 then
        recover()
    end

    if humanoid.Jump or humanoid:GetState() == Enum.HumanoidStateType.Jumping then
        recover()
    end
end)

-- 🚀 Activate fake death immediately
fakeDeath()
