-- MM2 ESP Script (Box + Role Detection)
-- Works in most MM2 servers with no GUI

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer

-- Cleanup old ESPs
for _, v in pairs(workspace:GetDescendants()) do
    if v:IsA("BillboardGui") and v.Name == "ESP" then
        v:Destroy()
    end
end

-- Create ESP
local function createESP(player)
    if player == localPlayer then return end
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end

    local root = player.Character:FindFirstChild("HumanoidRootPart")

    -- Avoid duplicates
    if root:FindFirstChild("ESP") then return end

    local esp = Instance.new("BillboardGui")
    esp.Name = "ESP"
    esp.Adornee = root
    esp.Size = UDim2.new(0, 100, 0, 40)
    esp.StudsOffset = Vector3.new(0, 3, 0)
    esp.AlwaysOnTop = true
    esp.Parent = root

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)
    label.TextStrokeTransparency = 0
    label.TextScaled = true
    label.Font = Enum.Font.GothamBold
    label.Text = player.Name
    label.Parent = esp
end

-- Detect Murderer and Sheriff
local function getRole(player)
    local backpack = player:FindFirstChildOfClass("Backpack")
    local character = player.Character

    if backpack then
        if backpack:FindFirstChild("Gun") then
            return "Sheriff"
        elseif backpack:FindFirstChild("Knife") then
            return "Murderer"
        end
    end

    if character then
        if character:FindFirstChild("Gun") then
            return "Sheriff"
        elseif character:FindFirstChild("Knife") then
            return "Murderer"
        end
    end

    return "Player"
end

-- Update ESP text and color
local function updateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player == localPlayer then continue end

        local char = player.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then continue end

        local root = char.HumanoidRootPart
        local role = getRole(player)
        local color = Color3.fromRGB(255, 255, 255)

        if role == "Sheriff" then
            color = Color3.fromRGB(0, 200, 255)
        elseif role == "Murderer" then
            color = Color3.fromRGB(255, 60, 60)
        end

        -- Create ESP if not exist
        if not root:FindFirstChild("ESP") then
            createESP(player)
        end

        -- Update label
        local gui = root:FindFirstChild("ESP")
        if gui and gui:IsA("BillboardGui") then
            local label = gui:FindFirstChildOfClass("TextLabel")
            if label then
                label.Text = string.format("[%s] %s", role, player.Name)
                label.TextColor3 = color
            end
        end
    end
end

-- Loop and update ESP
spawn(function()
    while true do
        pcall(updateESP)
        wait(2)
    end
end)

print("âœ… MM2 ESP Loaded")
